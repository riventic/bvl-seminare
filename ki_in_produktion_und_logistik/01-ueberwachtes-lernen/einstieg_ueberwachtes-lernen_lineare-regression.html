<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Interaktive Lineare Regression</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 20px;
            max-width: 1400px;
            width: 100%;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .content {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .chart-container {
            flex: 1;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            position: relative;
            overflow: hidden;
        }

        #canvas {
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: move;
            display: block;
            max-width: 100%;
            height: auto;
            touch-action: none;
        }

        .info-panel {
            width: 300px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }

        .model-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .model-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .formula {
            font-size: 1.1em;
            text-align: center;
            padding: 12px;
            background: #f0f0f0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin-bottom: 12px;
        }

        .parameter {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #e8eaf6;
            border-radius: 5px;
            margin-bottom: 8px;
        }

        .parameter-name {
            font-weight: bold;
            color: #333;
            font-size: 0.9em;
        }

        .parameter-value {
            font-family: 'Courier New', monospace;
            color: #667eea;
            font-size: 1.1em;
        }

        .error-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
        }

        .error-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .error-value {
            font-size: 1.8em;
            text-align: center;
            color: #e74c3c;
            font-weight: bold;
            padding: 12px;
            background: #ffe8e8;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }

        .controls {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .control-title {
            font-weight: bold;
            margin-bottom: 12px;
            color: #333;
        }

        button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 8px;
        }

        button:hover, button:active {
            background: #5568d3;
        }

        .instruction {
            background: #fff3cd;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #ffc107;
        }

        .instruction-title {
            font-weight: bold;
            margin-bottom: 6px;
            color: #856404;
        }

        .instruction-text {
            font-size: 0.85em;
            color: #856404;
            line-height: 1.4;
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .container {
                padding: 15px;
            }

            h1 {
                font-size: 1.3em;
                margin-bottom: 15px;
            }

            .content {
                flex-direction: column;
                gap: 15px;
            }

            .info-panel {
                width: 100%;
            }

            .chart-container {
                padding: 10px;
            }

            .instruction-text {
                font-size: 0.8em;
            }

            .parameter-name {
                font-size: 0.85em;
            }

            .error-value {
                font-size: 1.5em;
            }

            button {
                padding: 10px;
                font-size: 0.95em;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.1em;
            }

            .formula {
                font-size: 1em;
            }

            .parameter-name {
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Interaktive Lineare Regression</h1>
        
        <div class="instruction">
            <div class="instruction-title">üí° Anleitung:</div>
            <div class="instruction-text">
                Ziehe die rote Regressionslinie mit der Maus oder deinem Finger, um Œ∏‚ÇÄ und Œ∏‚ÇÅ anzupassen. 
                Beobachte, wie sich der mittlere quadratische Fehler (MSE) ver√§ndert!
            </div>
        </div>

        <div class="content">
            <div class="chart-container">
                <canvas id="canvas"></canvas>
            </div>

            <div class="info-panel">
                <div class="model-box">
                    <div class="model-title">Modell:</div>
                    <div class="formula">h<sub>Œ∏</sub>(x) = Œ∏‚ÇÄ + Œ∏‚ÇÅx</div>
                    <div class="parameter">
                        <span class="parameter-name">Œ∏‚ÇÄ (Y-Schnittpunkt):</span>
                        <span class="parameter-value" id="theta0">0.00</span>
                    </div>
                    <div class="parameter">
                        <span class="parameter-name">Œ∏‚ÇÅ (Steigung):</span>
                        <span class="parameter-value" id="theta1">0.50</span>
                    </div>
                </div>

                <div class="error-box">
                    <div class="error-title">Mittlerer quadratischer Fehler:</div>
                    <div class="error-value" id="mse">0.00</div>
                </div>

                <div class="controls">
                    <div class="control-title">Steuerung:</div>
                    <button onclick="app.fitOptimal()">Optimale Anpassung</button>
                    <button onclick="app.resetLine()">Zur√ºcksetzen</button>
                    <button onclick="app.randomizeData()">Neue Datenpunkte</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class LinearRegressionApp {
            constructor() {
                this.canvas = document.getElementById('canvas');
                this.ctx = this.canvas.getContext('2d');
                
                // Datenpunkte - MUSS VOR resizeCanvas() initialisiert werden
                this.dataPoints = [
                    {x: 1, y: 0.5}, {x: 2, y: 2}, {x: 4, y: 1.5}, {x: 4, y: 3.5},
                    {x: 6, y: 2.5}, {x: 6, y: 5.5}, {x: 8, y: 3.5}, {x: 8, y: 4.8},
                    {x: 9, y: 4.5}, {x: 10, y: 6.5}
                ];
                
                // Modellparameter
                this.theta0 = 0;
                this.theta1 = 0.5;
                
                // Drag-Zustand
                this.isDragging = false;
                this.dragMode = null;
                this.dragStartY = 0;
                this.dragStartTheta0 = 0;
                this.dragStartX = 0;
                this.dragStartY2 = 0;
                this.dragStartTheta1 = 0;
                
                // Achsen-Einstellungen
                this.xMin = 0;
                this.xMax = 12;
                this.yMin = 0;
                this.yMax = 7;
                
                // Setze Canvas-Gr√∂√üe basierend auf Container
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                
                this.setupEventListeners();
                this.draw();
                this.updateDisplay();
            }
            
            resizeCanvas() {
                const container = this.canvas.parentElement;
                const containerWidth = container.clientWidth - 30; // padding
                
                // Behalte Aspect Ratio 4:3
                let width = Math.min(containerWidth, 800);
                let height = width * 0.75;
                
                // F√ºr sehr kleine Bildschirme
                if (window.innerWidth < 480) {
                    width = containerWidth;
                    height = containerWidth * 0.9;
                }
                
                this.canvas.width = width;
                this.canvas.height = height;
                this.padding = Math.max(40, width * 0.06);
                
                if (this.ctx) {
                    this.draw();
                }
            }
            
            setupEventListeners() {
                // Mouse Events
                this.canvas.addEventListener('mousedown', (e) => this.onPointerDown(e));
                this.canvas.addEventListener('mousemove', (e) => this.onPointerMove(e));
                this.canvas.addEventListener('mouseup', (e) => this.onPointerUp(e));
                this.canvas.addEventListener('mouseleave', (e) => this.onPointerUp(e));
                
                // Touch Events
                this.canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    this.onPointerDown(touch);
                });
                
                this.canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    this.onPointerMove(touch);
                });
                
                this.canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.onPointerUp(e);
                });
            }
            
            getPointerPosition(e) {
                const rect = this.canvas.getBoundingClientRect();
                const scaleX = this.canvas.width / rect.width;
                const scaleY = this.canvas.height / rect.height;
                
                let clientX = e.clientX !== undefined ? e.clientX : e.pageX;
                let clientY = e.clientY !== undefined ? e.clientY : e.pageY;
                
                return {
                    x: (clientX - rect.left) * scaleX,
                    y: (clientY - rect.top) * scaleY
                };
            }
            
            toCanvasX(x) {
                return this.padding + (x - this.xMin) / (this.xMax - this.xMin) * (this.canvas.width - 2 * this.padding);
            }
            
            toCanvasY(y) {
                return this.canvas.height - this.padding - (y - this.yMin) / (this.yMax - this.yMin) * (this.canvas.height - 2 * this.padding);
            }
            
            fromCanvasX(canvasX) {
                return this.xMin + (canvasX - this.padding) / (this.canvas.width - 2 * this.padding) * (this.xMax - this.xMin);
            }
            
            fromCanvasY(canvasY) {
                return this.yMin + (this.canvas.height - this.padding - canvasY) / (this.canvas.height - 2 * this.padding) * (this.yMax - this.yMin);
            }
            
            predict(x) {
                return this.theta0 + this.theta1 * x;
            }
            
            calculateMSE() {
                let sum = 0;
                for (let point of this.dataPoints) {
                    let prediction = this.predict(point.x);
                    let error = prediction - point.y;
                    sum += error * error;
                }
                return sum / this.dataPoints.length;
            }
            
            distanceToLine(mouseX, mouseY) {
                let x = this.fromCanvasX(mouseX);
                let y = this.fromCanvasY(mouseY);
                let yPred = this.predict(x);
                let distanceInDataUnits = Math.abs(y - yPred);
                let yRange = this.yMax - this.yMin;
                let canvasHeight = this.canvas.height - 2 * this.padding;
                return (distanceInDataUnits / yRange) * canvasHeight;
            }
            
            onPointerDown(e) {
                const pos = this.getPointerPosition(e);
                let distance = this.distanceToLine(pos.x, pos.y);
                
                if (distance < 20) {
                    this.isDragging = true;
                    let x = this.fromCanvasX(pos.x);
                    
                    if (e.shiftKey || Math.abs(x - this.xMax/2) > this.xMax * 0.3) {
                        this.dragMode = 'rotate';
                        this.dragStartX = pos.x;
                        this.dragStartY2 = pos.y;
                        this.dragStartTheta1 = this.theta1;
                        this.dragStartTheta0 = this.theta0;
                    } else {
                        this.dragMode = 'line';
                        this.dragStartY = pos.y;
                        this.dragStartTheta0 = this.theta0;
                    }
                }
            }
            
            onPointerMove(e) {
                const pos = this.getPointerPosition(e);
                
                if (!this.isDragging) {
                    return;
                }
                
                if (this.dragMode === 'line') {
                    let deltaY = pos.y - this.dragStartY;
                    let deltaDataY = -deltaY / (this.canvas.height - 2 * this.padding) * (this.yMax - this.yMin);
                    this.theta0 = this.dragStartTheta0 + deltaDataY;
                } else if (this.dragMode === 'rotate') {
                    let deltaY = pos.y - this.dragStartY2;
                    let deltaDataY = -deltaY / (this.canvas.height - 2 * this.padding) * (this.yMax - this.yMin);
                    let centerX = this.xMax / 2;
                    let x = this.fromCanvasX(pos.x);
                    let slopeChange = deltaDataY / (x - centerX + 0.1);
                    this.theta1 = this.dragStartTheta1 + slopeChange;
                    this.theta0 = this.dragStartTheta0 + deltaDataY - slopeChange * centerX;
                }
                
                this.draw();
                this.updateDisplay();
            }
            
            onPointerUp(e) {
                this.isDragging = false;
                this.dragMode = null;
            }
            
            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.drawAxes();
                this.drawVerticalLines();
                this.drawRegressionLine();
                this.drawDataPoints();
            }
            
            drawAxes() {
                this.ctx.strokeStyle = '#333';
                this.ctx.lineWidth = 2;
                const fontSize = Math.max(10, this.canvas.width * 0.018);
                this.ctx.font = `${fontSize}px Arial`;
                this.ctx.fillStyle = '#333';
                
                // X-Achse
                this.ctx.beginPath();
                this.ctx.moveTo(this.padding, this.canvas.height - this.padding);
                this.ctx.lineTo(this.canvas.width - this.padding, this.canvas.height - this.padding);
                this.ctx.stroke();
                
                // Y-Achse
                this.ctx.beginPath();
                this.ctx.moveTo(this.padding, this.padding);
                this.ctx.lineTo(this.padding, this.canvas.height - this.padding);
                this.ctx.stroke();
                
                // X-Achsen-Beschriftung
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'top';
                for (let i = 0; i <= this.xMax; i += 2) {
                    let x = this.toCanvasX(i);
                    this.ctx.fillText(i, x, this.canvas.height - this.padding + 8);
                }
                
                // Y-Achsen-Beschriftung
                this.ctx.textAlign = 'right';
                this.ctx.textBaseline = 'middle';
                for (let i = 0; i <= this.yMax; i++) {
                    let y = this.toCanvasY(i);
                    this.ctx.fillText(i, this.padding - 8, y);
                }
                
                // Achsentitel
                const labelSize = Math.max(14, this.canvas.width * 0.022);
                this.ctx.font = `italic ${labelSize}px Arial`;
                this.ctx.textAlign = 'center';
                this.ctx.fillText('x', this.canvas.width / 2, this.canvas.height - 15);
                
                this.ctx.save();
                this.ctx.translate(15, this.canvas.height / 2);
                this.ctx.rotate(-Math.PI / 2);
                this.ctx.fillText('y', 0, 0);
                this.ctx.restore();
            }
            
            drawDataPoints() {
                const starSize = Math.max(16, this.canvas.width * 0.025);
                this.ctx.fillStyle = '#00BFFF';
                this.ctx.font = `bold ${starSize}px Arial`;
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                
                for (let point of this.dataPoints) {
                    let x = this.toCanvasX(point.x);
                    let y = this.toCanvasY(point.y);
                    this.ctx.fillText('*', x, y);
                }
            }
            
            drawVerticalLines() {
                this.ctx.strokeStyle = '#5A78C9';
                this.ctx.lineWidth = 1;
                this.ctx.setLineDash([5, 5]);
                
                const labelSize = Math.max(10, this.canvas.width * 0.015);
                this.ctx.font = `italic ${labelSize}px Arial`;
                
                for (let point of this.dataPoints) {
                    let x = this.toCanvasX(point.x);
                    let yActual = this.toCanvasY(point.y);
                    let yPred = this.toCanvasY(this.predict(point.x));
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, yActual);
                    this.ctx.lineTo(x, yPred);
                    this.ctx.stroke();
                    
                    this.ctx.fillStyle = '#4169E1';
                    let labelY = (yActual + yPred) / 2;
                    this.ctx.fillText('min', x + 12, labelY);
                }
                
                this.ctx.setLineDash([]);
            }
            
            drawRegressionLine() {
                this.ctx.strokeStyle = '#FF4444';
                this.ctx.lineWidth = 3;
                
                let x1 = this.xMin;
                let y1 = this.predict(x1);
                let x2 = this.xMax;
                let y2 = this.predict(x2);
                
                this.ctx.beginPath();
                this.ctx.moveTo(this.toCanvasX(x1), this.toCanvasY(y1));
                this.ctx.lineTo(this.toCanvasX(x2), this.toCanvasY(y2));
                this.ctx.stroke();
            }
            
            updateDisplay() {
                document.getElementById('theta0').textContent = this.theta0.toFixed(2);
                document.getElementById('theta1').textContent = this.theta1.toFixed(2);
                document.getElementById('mse').textContent = this.calculateMSE().toFixed(2);
            }
            
            fitOptimal() {
                let n = this.dataPoints.length;
                let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;
                
                for (let point of this.dataPoints) {
                    sumX += point.x;
                    sumY += point.y;
                    sumXY += point.x * point.y;
                    sumX2 += point.x * point.x;
                }
                
                this.theta1 = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
                this.theta0 = (sumY - this.theta1 * sumX) / n;
                
                this.draw();
                this.updateDisplay();
            }
            
            resetLine() {
                this.theta0 = 0;
                this.theta1 = 0.5;
                this.draw();
                this.updateDisplay();
            }
            
            randomizeData() {
                this.dataPoints = [];
                for (let i = 0; i < 10; i++) {
                    this.dataPoints.push({
                        x: Math.random() * (this.xMax - 1) + 0.5,
                        y: Math.random() * (this.yMax - 0.5) + 0.5
                    });
                }
                this.draw();
                this.updateDisplay();
            }
        }
        
        let app;
        window.addEventListener('load', () => {
            app = new LinearRegressionApp();
        });
    </script>
</body>
</html>
